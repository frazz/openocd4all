# Simple openocd startup script for cc1310

source [find interface/ftdi/xds100v3.cfg]
transport select jtag
source [find target/cc1310.cfg]

reset_config none

$_TARGETNAME configure -event reset-start {
  echo "reset-start hook..done"
}

$_TARGETNAME configure -event reset-end {
  echo "reset-end hook..done"
}

# reset mcu
proc reset_mcu { } {
  init
  ftdi_set_signal PWR_RST 1
  set result [ jtag arp_init ]
  sleep 100
  return $result
}

# try reset until success
proc reset_until_success { } {
  set i 0
  while {$i < 20} {
    puts "Try reset attempt $i..."
    set result [ reset_mcu ]
    if { $result != 1 } {
       echo "Failed reset"
    } else {
       echo "Successful reset"
       break
    }
    incr i
  }
}

reset_until_success

echo "OpenOCD setup script end."
